<main class="Site-content">
<div class="container panel-body">

<div class="col-md-12 container row">
  <div class="col-md-3">
    <div class="panel panel-default panel-body">
      <img src=<%= @user.img %> width="100%" class="panel-body">
    </div>
    <%= link_to "Follow", followings_path(id: @user.id), method: :post %>

    <% if @user.github || @user.dribbble || current_user == @user %>
      <div class="panel panel-default">
      <div class="panel-body">
      <% if current_user && current_user == @user %>
        <div class="row">
          <% if @user.github %>
          <div class="col-md-6">
            <h3>Github</h3>
          </div>
          <div class="col-md-2 panel-body">
            <h4><%= link_to "Projects", @user.github_url %></h4>
          </div>
        </div>
        <div class="row">
          <% elsif @user.github.nil? %>
          <div class="col-md-6">
            <h3>Github</h3>
          </div>
          <div class="col-md-2 panel-body">
            <h4><%= link_to "Connect", "/auth/github?user_id=#{@user.id}" %></h4>
          </div>
          <% end %>

          <% if @user.dribbble %>
          <div class="col-md-6">
            <h3>Dribbble</h3>
          </div>
          <div class="col-md-2 panel-body">
            <h4><%= link_to "Projects", @user.dribbble_url %></h4>
          </div>
          <% elsif @user.dribbble.nil? %>
          <div class="col-md-6">
            <h3>Dribbble</h3>
          </div>
          <div class="col-md-2 panel-body">
            <h4><%= link_to "Connect", user_dribbble_oauth_request_path(user_id: @user.id) %></h4>
          </div>
          <% end %>
        </div>
        </div>
      <% end %>

        <% if (current_user && current_user != @user && @user.github) || (!logged_in? && @user.github)%>
          <div class="col-md-12">
              <h4>Github: <%= link_to "Projects", @user.github_url %></h4>
          </div>
        <% end %>

        <% if (current_user && current_user != @user && @user.dribbble) || (!logged_in? && @user.dribbble)%>
          <div class="col-md-12">
            <h4>Dribbble: <%= link_to "Projects", @user.dribbble_url %></h4>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="panel panel-default">
      <div class="panel-body">
        <div class="row">
          <div class="col-md-8">
            <h3>Skills</h3>
          </div>
          <div class="col-md-1 panel-body">
            <% if logged_in? && @user == current_user %>
              <h4><%= link_to "add", new_skill_path %></h4>
            <% end %>
          </div>
        </div>

        <div class="row">
          <% @user.skills.each do |skill| %>
            <p><%= render "/skills/individual_skill", skill: skill %></p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="row container-fluid">
    <div class="col-md-5">
      <div class="">
          <h1><%= @user.visible_name %></h1>
            <h4><%= link_to @user.role.capitalize, users_path %></h4>
          <% if logged_in? && @user == current_user %>
          <% end %>
      </div>
    </div>

    <div class="col-md-3">
      <div class="panel-body pull-right">
        <h4>Current Projects: <%= @user.projects.length %></h4>
        <h4><%= @user.text_rating %></h4>
        <% if logged_in? && @user != current_user %>
          <%= link_to "Send Chat", "#", class: "btn btn-success btn-xs small-custom start-conversation", "data-sid" => current_user.id, "data-rip" => @user.id, "data-im" => "chat" %>

          <%= form_for(@conversation) do |f| %>
          <%= f.hidden_field :sender_id, value: current_user.id %>
          <%= f.hidden_field :receiver_id, value: @user.id %>
          <%= f.hidden_field :conversation_type, value: "inbox_message" %>
          <%= f.submit "Send Message", class: "btn btn-success btn-xs  small-custom start-mail-conversation"%>
          <% end %>
        <% end %>
        <p><%= link_to "Edit Profile", edit_user_path(@user) %></p>
      </div>
    </div>

    <div class="row">
      <div class="panel-body col-md-8">
        <p><%= @user.bio %></p>
      </div>

      <div class="col-md-8">
        <% if @user.projects.length > 0 %>
        <div class="panel-body panel panel-default">
          <h2>Seeking Collaborators</h2>
          <% @user.projects.each do |project| %>
            <%= render partial: "/projects/index_show", locals: { project: project } %>
          <% end %>
        </div>
        <% end %>

        <% if @user.reviews.length > 0 %>
          <div class="panel panel-default">
            <div class="panel-body">
            <h2>Reviews</h2>
              <%if logged_in? && current_user != @user %>
                <%=link_to 'Leave a Review', new_review_path(params:{user_id: @user.id})  %>
              <%end%>

              <% @user.reviews.each do |review| %>
                <p><%review.rating.times do %> &#9734; <%end%> | <%=review.body.capitalize%> |
                  <% if review.reviewer == current_user %>
                    <%= link_to 'edit', edit_review_path(params:{id: review.id})%>
                  <% end %></p>
              <% end %>
            </div>
          </div>
        <%end%>

        <% if current_user && current_user != @user %>
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>Leave a review</h3>
              <%= render partial: "/reviews/form", locals: { review: @review } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>


</div>

</main>

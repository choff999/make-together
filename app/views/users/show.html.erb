<%= render partial: 'shared/navbar_opaque' %>

<main class="Site-content">
<div class="container-fluid">

<div class="container panel-body">
<div class="row">
  <div class="panel panel-default panel-body col-md-3">
    <img src=<%= @user.img %> width="100%">
  </div>

  <div class="row container-fluid">
    <div class="panel-body col-md-4">
      <h1><%= @user.visible_name %></h1>
      <h3><%= link_to @user.role.capitalize, users_path %></h3>
      <% if logged_in? && @user == current_user %>
        <h3><%= link_to "Edit Profile", edit_user_path(@user) %></h3>
      <% end %>
    </div>

    <div class="panel-body col-md-4">
      <% if logged_in? && @user != current_user %>
        <%= link_to "Send Chat", "#", class: "btn btn-success btn-xs start-conversation", "data-sid" => current_user.id, "data-rip" => @user.id %>

        <%= link_to "Send Message", {action: 'create', controller: 'conversations', sender_id: current_user.id, recipient_id: @user.id, conversation_type: "inbox_message" }, method: :post, class: "btn btn-success btn-xs start-mail-conversation" %>
      <% end %>
    </div>

    <div class="panel-body col-md-8">
      <p><%= @user.bio %></p>
    </div>
  </div>
</div>

<div class="row">
  <div class="panel panel-default col-md-3">
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <h3>Skills</h3>
        </div>
        <div class="col-md-1 panel-body">
          <% if logged_in? && @user == current_user %>
            <h4><%= link_to "add", new_skill_path %></h4>
          <% end %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
            <% @user.skills.each do |skill| %>
              <p><%= link_to skill.body, skill_path(skill)%></p>
            <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-9">
    <% if @user.projects.length > 0 %>
      <h2>Seeking Collaborators</h2>

      <% @user.projects.each do |project| %>
        <%= render partial: "/projects/index_show", locals: { project: project } %>
      <% end %>
    <% end %>

    <% if @user.reviews.length > 0 %>
      <div class="panel panel-default">
        <div class="panel-body">
        <h2>Reviews</h2>
          <%if logged_in? && current_user != @user %>
            <%=link_to 'Leave a Review', new_review_path(params:{user_id: @user.id})  %>
          <%end%>

          <% @user.reviews.each do |review| %>
            <p><%=review.rating%> stars | <%=review.body.capitalize%> |
              <% if review.reviewer == current_user %>
                <%= link_to 'edit', edit_review_path(params:{id: review.id})%>
              <% end %></p>
          <% end %>
        </div>
      </div>
    <%end%>
</div>
</div>
</div>

</main>
